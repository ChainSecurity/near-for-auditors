
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../deployment/">
      
      
        <link rel="next" href="../storage/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.2">
    
    
      
        <title>Execution - NEAR for Advanced Users</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d451bc0e.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#function-calls-to-contracts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NEAR for Advanced Users" class="md-header__button md-logo" aria-label="NEAR for Advanced Users" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NEAR for Advanced Users
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Execution
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NEAR for Advanced Users" class="md-nav__button md-logo" aria-label="NEAR for Advanced Users" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    NEAR for Advanced Users
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Execution
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Execution
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#submitting-a-new-transaction" class="md-nav__link">
    Submitting a new transaction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executing-an-actionreceipt" class="md-nav__link">
    Executing an ActionReceipt
  </a>
  
    <nav class="md-nav" aria-label="Executing an ActionReceipt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#near-runtime" class="md-nav__link">
    NEAR runtime
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wasm-entry-points" class="md-nav__link">
    WASM entry points
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-near_bindgen-macro" class="md-nav__link">
    The #[near_bindgen] macro
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../cross-contract-calls/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross-contract Calls
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../gas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gas
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../issues/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Common Issues
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resources
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#submitting-a-new-transaction" class="md-nav__link">
    Submitting a new transaction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executing-an-actionreceipt" class="md-nav__link">
    Executing an ActionReceipt
  </a>
  
    <nav class="md-nav" aria-label="Executing an ActionReceipt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#near-runtime" class="md-nav__link">
    NEAR runtime
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wasm-entry-points" class="md-nav__link">
    WASM entry points
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-near_bindgen-macro" class="md-nav__link">
    The #[near_bindgen] macro
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="function-calls-to-contracts">Function Calls to Contracts</h1>
<p>Let's consider the <a href="https://github.com/near/near-sdk-rs/blob/master/examples/status-message/src/lib.rs">StatusMessage</a> contract:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">near_sdk</span>::<span class="n">borsh</span>::<span class="p">{</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">BorshDeserialize</span><span class="p">,</span><span class="w"> </span><span class="n">BorshSerialize</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">near_sdk</span>::<span class="p">{</span>
<span class="w">    </span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">near_bindgen</span><span class="p">,</span><span class="w"> </span><span class="n">AccountId</span><span class="p">,</span><span class="w"> </span><span class="n">collections</span>
<span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">near_sdk</span>::<span class="n">store</span>::<span class="n">UnorderedMap</span><span class="p">;</span>


<span class="cp">#[near_bindgen]</span>
<span class="cp">#[derive(Default, BorshDeserialize, BorshSerialize)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">StatusMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">records</span>: <span class="nc">UnorderedMap</span><span class="o">&lt;</span><span class="n">AccountId</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="cp">#[near_bindgen]</span>
<span class="k">impl</span><span class="w"> </span><span class="n">StatusMessage</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cp">#[init]</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Initializing `status_updates` with unique key prefix.</span>
<span class="w">        </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">records</span>: <span class="nc">UnorderedMap</span>::<span class="n">new</span><span class="p">(</span><span class="s">b&quot;r&quot;</span><span class="p">.</span><span class="n">to_vec</span><span class="p">()),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cp">#[payable]</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">set_status</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">message</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">account_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span>::<span class="n">predecessor_account_id</span><span class="p">();</span>
<span class="w">        </span><span class="n">log</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{} set_status with message {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">records</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_status</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">account_id</span>: <span class="nc">AccountId</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">log</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;get_status for account_id {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">account_id</span><span class="p">);</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">records</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">account_id</span><span class="p">).</span><span class="n">cloned</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The state of the contract consists of a <code>UnorderedMap</code> from <code>AccountId</code> to <code>String</code>.
Note that <code>UnorderedMap</code> is part of the <code>near_sdk</code> library. For now we can think of it as the equivalent to the <code>HashMap</code> in the Rust (<code>std</code>) standard library. We will discuss <a href="../storage/">later</a> the differences between <code>near_sdk::store::UnorderedMap</code> and <code>std::collections::HashMap</code>.</p>
<p>The contract exposes three public functions (indicated with <code>pub</code>), namely <code>new</code>, <code>set_status</code> and <code>get_status</code>. We'll ignore <code>new</code> for now as we dive deeper into it in a different tutorial. Let's focus on the other two for now:</p>
<ul>
<li>
<p><code>set_status</code>: enables users to save a message. When this function is called, it first retrieves the account ID of the user who called the contract by using the <code>env::predecessor_account_id()</code> command. To put it simply, this command works similarly to <code>msg.sender</code> in Ethereum and Solidity. Once the account ID is obtained, the <code>records</code> map is updated by associating the message with the corresponding account ID.</p>
</li>
<li>
<p><code>get_status</code>: allows users to retrieve the message for any account by simply passing the <code>account_id</code> of that specific account. Note that in case the <code>account_id</code> key is not present in the map, <code>self.records.get(...)</code> will return <code>None</code>. For more information about the <code>Option</code> type, please refer <a href="https://doc.rust-lang.org/std/option/">here</a>.</p>
</li>
</ul>
<h2 id="submitting-a-new-transaction">Submitting a new transaction</h2>
<p>Users submit signed <a href="https://nomicon.io/RuntimeSpec/Transactions">transactions</a>. For the scope of this tutorial, we will ignore how a transaction is <a href="https://nomicon.io/NetworkSpec/">routed</a> to a chunk-producer. Transactions specify batches of <a href="https://nomicon.io/RuntimeSpec/Actions.html">Actions</a>. These actions are strictly ordered, an action is executed only if the previous action has been completed. Moreover there is no guarantee that no other action submitted by other accounts will not be executed between the actions in the batch.</p>
<p>To execute a function call, a user needs to specify a <code>FunctionCall</code> action. The <code>FunctionCall</code> Action is translated into an <code>ActionReceipt</code>. <a href="https://nomicon.io/RuntimeSpec/Receipts.html">Receipts</a> are a fundamental component of the NEAR protocol. Shards communicate using receipts. Developers familiar with Ethereum should consider NEAR receipts to be similar to Ethereum transactions, in the sense that they are executed atomically. However, any subsequent cross-contract calls produced are <strong>not</strong> executed atomically, since they are asynchronous and will execute at the earliest in the next block. Receipts are also different from Ethereum since end users cannot produce receipts, only validators can.</p>
<div class="highlight"><pre><span></span><code><span class="n">ActionReceipt</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">id</span>: <span class="s">&quot;A1&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="n">signer_id</span>: <span class="s">&quot;alice&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="n">signer_public_key</span>: <span class="s">&quot;6934...e248&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="n">receiver_id</span>: <span class="s">&quot;status-message&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="n">predecessor_id</span>: <span class="s">&quot;alice&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="n">input_data_ids</span>: <span class="p">[],</span>
<span class="w">     </span><span class="n">output_data_receivers</span>: <span class="p">[],</span>
<span class="w">     </span><span class="n">actions</span>: <span class="p">[</span><span class="n">FunctionCall</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">         </span><span class="n">gas</span>: <span class="mi">100000</span><span class="p">,</span><span class="w"> </span><span class="n">deposit</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">method_name</span>: <span class="s">&quot;set_status&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">         </span><span class="n">args</span>: <span class="s">&quot;{&#39;hello_world&#39;}&quot;</span><span class="w"> </span><span class="p">}],</span>
<span class="w"> </span><span class="p">}</span>
</code></pre></div>
<h2 id="executing-an-actionreceipt">Executing an <code>ActionReceipt</code></h2>
<p>Each contract is stored in the form of <a href="https://webassembly.org/">WebAssembly</a> (WASM for short). The contract is essentially executed by <a href="https://docs.wasmer.io/">WASMER</a> which is a runtime for WASM. WASMER is wrapped by NEAR's <a href="https://github.com/near/nearcore/tree/master/runtime">runtime</a>. WASM is to Rust or AssemblyScript what EVM bytecode is to Solidity smart contracts.</p>
<h3 id="near-runtime">NEAR runtime</h3>
<p>The runtime can be regarded as an interpreter for WASM which is allowed to interact with the environment. The WASM representation imports external functions which are executed by the NEAR runtime. For example, in the text representation (called WAT) of the <code>status-message</code> contract we will find the following command:</p>
<div class="highlight"><pre><span></span><code>(import &quot;env&quot; &quot;signer_account_id&quot; (func $env.signer_account_id (type $t5)))
</code></pre></div>
<p>This command lets the WASM runtime know that the a <code>signer_account_id</code> call will be executed by the environment.</p>
<p>We can also find calls like the following:</p>
<div class="highlight"><pre><span></span><code>(call $env.signer_account_id (i64.const -3))
</code></pre></div>
<p>This command is essentially a call to the environment. This means that the WASM execution will stop so that the host receives this call and executes it. In this particular case, the host will retrieve the <code>account_id</code> of the signer of this transaction.</p>
<h3 id="wasm-entry-points">WASM entry points</h3>
<p>An important distinction should be made between an EVM smart contract and a WASM contract. WASM smart contracts can have multiple entry points. The entry points are essentially the public functions of the smart contracts. These can be called by the NEAR runtime. The WASM command below exposes the <code>get_status</code> function to the runtime:</p>
<div class="highlight"><pre><span></span><code>(func $get_status (export &quot;get_status&quot;) (type $t11) ...
</code></pre></div>
<p>An observant reader of the WASM bytecode might notice that neither <code>set_status</code> nor <code>get_status</code> accept parameters on the WASM level. This is counter-intuitive given that both functions accept arguments on the Rust level. We further explore this in the next section.</p>
<h3 id="the-near_bindgen-macro">The <code>#[near_bindgen]</code> macro</h3>
<p>According to the <a href="https://www.near-sdk.io/"><code>near-sdk-rs</code></a> documentation, the <code>#[near_bindgen]</code> macro should always be present to generate the necessary glue code for a valid NEAR contract. In this section, we dive deeper into its functionality.</p>
<p>Users can inspect the Rust code with the expanded macros by using <code>cargo-expand</code>. In the resulting code we can find the following:</p>
<div class="highlight"><pre><span></span><code><span class="o">..</span><span class="p">.</span>

<span class="cp">#[cfg(target_arch = </span><span class="s">&quot;wasm32&quot;</span><span class="cp">)]</span>
<span class="cp">#[no_mangle]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="k">fn</span> <span class="nf">set_status</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">near_sdk</span>::<span class="n">env</span>::<span class="n">setup_panic_hook</span><span class="p">();</span>
<span class="w">    </span><span class="cp">#[serde(crate = </span><span class="s">&quot;near_sdk::serde&quot;</span><span class="cp">)]</span>
<span class="w">    </span><span class="k">struct</span> <span class="nc">Input</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">message</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="cp">#[doc(hidden)]</span>
<span class="w">    </span><span class="cp">#[allow(non_upper_case_globals, unused_attributes, unused_qualifications)]</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="o">..</span><span class="p">.};</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">Input</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="p">}</span>: <span class="nc">Input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">near_sdk</span>::<span class="n">serde_json</span>::<span class="n">from_slice</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">near_sdk</span>::<span class="n">env</span>::<span class="n">input</span><span class="p">().</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Expected input since method has arguments.&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Failed to deserialize input from JSON.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">contract</span>: <span class="nc">StatusMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">near_sdk</span>::<span class="n">env</span>::<span class="n">state_read</span><span class="p">().</span><span class="n">unwrap_or_default</span><span class="p">();</span>
<span class="w">    </span><span class="n">contract</span><span class="p">.</span><span class="n">set_status</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="n">near_sdk</span>::<span class="n">env</span>::<span class="n">state_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">contract</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#[cfg(target_arch = </span><span class="s">&quot;wasm32&quot;</span><span class="cp">)]</span>
<span class="cp">#[no_mangle]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_status</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">..</span><span class="p">.</span>
<span class="p">}</span>
</code></pre></div>
<p>By looking at this snippet we can validate that neither of the exported functions <code>set_status</code> and <code>get_status</code> actually accept arguments. They wrap the actual functions we defined inside <code>impl StatusMessage</code>. We note that the <code>Input</code> struct indeed contains the message. In <code>get_status</code> it contains <code>account_id</code>. Moreover, there are two calls to the environment, one to retrieve the actual input (<code>env::input</code>) and one to get the structure which corresponds to the contract state (<code>env::state_read()</code>).
After the execution terminates, the resulting state of the contract is written to persistent memory (<code>env::state_write(&amp;contract)</code>).</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.726fbb30.min.js"></script>
      
    
  </body>
</html>